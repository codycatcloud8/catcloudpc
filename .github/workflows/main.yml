name: MacOS Cloud PC - Setupon: workflow_dispatch:jobs: build: name: Setting Up MacOS Cloud PC runs-on: macos-14 timeout-minutes: 9999 steps: # Section 1: Force Update Homebrew & Grant Permissions - name: Force Update Homebrew & Grant Permissions run: | echo "Resetting Homebrew environment..." sudo rm -rf /Library/Caches/Homebrew brew cleanup -s sudo chown -R $(whoami) $(brew --prefix)/* || true sudo chmod u+w $(brew --prefix)/* || true echo "Forcing Homebrew update..." export HOMEBREW_NO_AUTO_UPDATE=1 brew update --force --quiet brew upgrade --force --quiet brew doctor || true echo "  Homebrew update completed!" # Section 2: Disable Spotlight Indexing - name: Disable Spotlight Indexing run: | echo "Disabling Spotlight indexing for performance optimization..." sudo mdutil -i off -a # Section 3: Create a New Admin User - name: Create Admin User "Notto" run: | USERNAME="Notto" PASSWORD="P@ssw0rd!" echo "Creating new admin user: $USERNAME..." sudo dscl . -create /Users/$USERNAME sudo dscl . -create /Users/$USERNAME UserShell /bin/bash sudo dscl . -create /Users/$USERNAME RealName "NottoXD" sudo dscl . -create /Users/$USERNAME UniqueID 1001 sudo dscl . -create /Users/$USERNAME PrimaryGroupID 80 sudo dscl . -create /Users/$USERNAME NFSHomeDirectory /Users/$USERNAME sudo dscl . -passwd /Users/$USERNAME "$PASSWORD" sudo createhomedir -c -u $USERNAME > /dev/null sudo dscl . -append /Groups/admin GroupMembership $USERNAME # Fix permission issues sudo chown -R $USERNAME /Users/$USERNAME sudo chmod 700 /Users/$USERNAME echo "  Admin user $USERNAME created successfully." # Section 4: Enable Apple Remote Desktop (ARD) & VNC - name: Enable Apple Remote Desktop (ARD) & VNC
